# GitHub Actions workflow for Position Pure (PP) Algorithm Parallel Benchmark
name: PP Algorithm Parallel Benchmark

on:
  push:
    paths:
      - 'parallel/parallel_position_pure.cpp'
  workflow_dispatch:

jobs:
  benchmark:
    name: Dual-Core Performance Analysis
    runs-on: windows-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Compiler Environment
        # Using pre-installed MinGW on Windows runner
        run: |
          echo "C:\msys64\mingw64\bin" >> $GITHUB_PATH

      - name: Compile PP Algorithm
        # -O3 optimization for maximum permutation generation speed
        run: |
          g++ -O3 -march=native parallel/parallel_position_pure.cpp -o parallel/pp_parallel.exe

      - name: Run Benchmarks (N=10 to 13)
        shell: bash
        run: |
          # Create Markdown Header for Job Summary
          echo "### Performance Report: Position Pure (PP) Algorithm" >> $GITHUB_STEP_SUMMARY
          echo "| N | Core ID | Execution Time | Throughput (G/s) | Total Count |" >> $GITHUB_STEP_SUMMARY
          echo "|---|---|---|---|---|" >> $GITHUB_STEP_SUMMARY
          
          for n in 10 11 12 13
          do
            echo "Benchmarking N=$n..."
            ./parallel/pp_parallel.exe $n > output_$n.txt
            
            # Robust extraction logic using multi-stage awk
            # Grabs values based on '=' delimiter to avoid spacing issues
            c0_time=$(grep "Core 0" output_$n.txt | awk -F'=' '{print $2}' | awk '{print $1}')
            c0_tp=$(grep "Core 0" output_$n.txt | awk -F'=' '{print $3}' | awk '{print $1}')
            
            c1_time=$(grep "Core 1" output_$n.txt | awk -F'=' '{print $2}' | awk '{print $1}')
            c1_tp=$(grep "Core 1" output_$n.txt | awk -F'=' '{print $3}' | awk '{print $1}')
            
            total_cnt=$(grep "TOTAL COUNT:" output_$n.txt | awk '{print $NF}')
            
            # Fill the Markdown table
            echo "| $n | Core 0 | ${c0_time} | ${c0_tp} | - |" >> $GITHUB_STEP_SUMMARY
            echo "| $n | Core 1 | ${c1_time} | ${c1_tp} | ${total_cnt} |" >> $GITHUB_STEP_SUMMARY
          done
