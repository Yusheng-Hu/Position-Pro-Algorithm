# GitHub Actions workflow to benchmark the Position Pure (PP) Algorithm
name: PP Algorithm Parallel Benchmark

on:
  push:
    paths:
      - 'parallel/parallel_position_pure.cpp'
  workflow_dispatch:

jobs:
  benchmark:
    name: Dual-Core Performance Test
    runs-on: windows-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Configure Environment
        run: |
          echo "C:\msys64\mingw64\bin" >> $GITHUB_PATH

      - name: Compile Source Code
        run: |
          g++ -O3 -march=native parallel/parallel_position_pure.cpp -o parallel/pp_parallel.exe

      - name: Execute Benchmarks (N=10 to 13)
        shell: bash
        run: |
          # Initialize the Markdown table
          echo "### Performance Report: Position Pure (PP) Algorithm" >> $GITHUB_STEP_SUMMARY
          echo "| N | Core ID | Execution Time | Throughput (G/s) | Total Permutations |" >> $GITHUB_STEP_SUMMARY
          echo "|---|---|---|---|---|" >> $GITHUB_STEP_SUMMARY
          
          for n in 10 11 12 13
          do
            echo "Processing N=$n..."
            ./parallel/pp_parallel.exe $n > output_$n.txt
            
            # Use grep to find the line, then use awk with '=' and ' ' as delimiters to pick the numbers
            # Extract Time: looking for the value before 'fs'
            c0_time=$(grep "Core 0" output_$n.txt | awk -F'=' '{print $2}' | awk '{print $1}')
            c1_time=$(grep "Core 1" output_$n.txt | awk -F'=' '{print $2}' | awk '{print $1}')
            
            # Extract Throughput: looking for the value before 'G/s'
            c0_tp=$(grep "Core 0" output_$n.txt | awk -F'=' '{print $3}' | awk '{print $1}')
            c1_tp=$(grep "Core 1" output_$n.txt | awk -F'=' '{print $3}' | awk '{print $1}')
            
            total_cnt=$(grep "TOTAL COUNT:" output_$n.txt | awk '{print $NF}')
            
            # Append rows to summary table
            echo "| $n | Core 0 | ${c0_time} | ${c0_tp} | - |" >> $GITHUB_STEP_SUMMARY
            echo "| $n | Core 1 | ${c1_time} | ${c1_tp} | ${total_cnt} |" >> $GITHUB_STEP_SUMMARY
          done
