name: Algorithm Performance Comparison

on:
  push:
    branches: [ main ]
  workflow_dispatch: # Allows manual trigger from the Actions tab

jobs:
  benchmark:
    runs-on: ubuntu-latest
    # Optimization flags defined as environment variables for consistency
    env:
      CXX_FLAGS: "-O3 -ffast-math -march=native"

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Compile Programs
      run: |
        # Navigating to the specific directory for compilation
        cd FullPermutation
        g++ $CXX_FLAGS heap_perm.cpp -o heap_perm
        g++ $CXX_FLAGS permpure_full.cpp -o permpure_full

    - name: Run Benchmarks and Generate Table
      run: |
        cd FullPermutation
        
        # Initialize GitHub Step Summary with Markdown table header
        echo "### Permutation Algorithm Performance (N=10 to 13)" >> $GITHUB_STEP_SUMMARY
        echo "| N | Heap Algorithm (s) | PP Algorithm (s) | Speedup (Heap/PP) |" >> $GITHUB_STEP_SUMMARY
        echo "|---|---|---|---|" >> $GITHUB_STEP_SUMMARY
        
        # Iterating through the N values
        for n in 10 11 12 13
        do
          echo "Processing N=$n..."
          
          # Execute Heap Algorithm and extract time
          HEAP_TIME=$(./heap_perm $n | grep "EXECUTION_TIME:" | awk '{print $2}')
          
          # Execute PP Algorithm and extract time
          PP_TIME=$(./permpure_full $n | awk -F': ' '/EXECUTION_TIME/ {print $2}')
          
          # Calculate simple speedup ratio (optional but helpful)
          # Note: Using 'bc' for floating point division in shell
          SPEEDUP=$(echo "scale=2; $HEAP_TIME / $PP_TIME" | bc)
          
          # Write the result row to the summary table
          echo "| $n | $HEAP_TIME | $PP_TIME | ${SPEEDUP}x |" >> $GITHUB_STEP_SUMMARY
        done

    - name: Finalize
      run: echo "Benchmark successfully completed. Check the Summary tab for the results."
